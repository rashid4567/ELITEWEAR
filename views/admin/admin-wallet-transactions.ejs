<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Elite Wear - Wallet Transactions</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/adminStyle/wallet.css">
</head>
<body class="admin-dashboard">
<div class="app-container">
    <%- include("../partials/admin/header") %>
  <div class="main-content">
    
      <div class="content-wrapper">
        
          <header class="top-navbar">
              <div class="container-fluid">
                  <div class="d-flex justify-content-between align-items-center">
                      <div class="d-flex align-items-center">
                          <button class="menu-toggle me-3 btn-icon">
                              <i class="fas fa-bars"></i>
                          </button>
                          <h1 class="page-title mb-0">Wallet Transactions</h1>
                      </div>
                      <div class="d-flex align-items-center">
                          <div class="search-bar me-3">
                              <div class="input-group">
                                  <span class="input-group-text border-0">
                                      <i class="fas fa-search"></i>
                                  </span>
                                  <input type="text" class="form-control border-0" placeholder="Search transactions...">
                              </div>
                          </div>
                          <div class="dropdown me-3">
                              <button class="btn btn-icon" type="button" data-bs-toggle="dropdown">
                                  <span class="notification-badge"></span>
                                  <i class="fas fa-bell"></i>
                              </button>
                              <div class="dropdown-menu dropdown-menu-end notification-dropdown">
                                  <h6 class="dropdown-header">Notifications</h6>
                                  <div class="notification-item">
                                      <div class="notification-icon bg-success-soft">
                                          <i class="fas fa-wallet text-success"></i>
                                      </div>
                                      <div class="notification-content">
                                          <p class="mb-0">New wallet transaction received</p>
                                          <small class="text-muted">5 minutes ago</small>
                                      </div>
                                  </div>
                                  <div class="notification-item">
                                      <div class="notification-icon bg-danger-soft">
                                          <i class="fas fa-undo-alt text-danger"></i>
                                      </div>
                                      <div class="notification-content">
                                          <p class="mb-0">Refund request approved</p>
                                          <small class="text-muted">1 hour ago</small>
                                      </div>
                                  </div>
                                  <div class="dropdown-footer">
                                      <a href="#">View all notifications</a>
                                  </div>
                              </div>
                          </div>
                          <div class="dropdown">
                              <button class="btn btn-icon profile-dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                  <div class="avatar-circle">
                                      <img src="https://randomuser.me/api/portraits/men/41.jpg" alt="Admin">
                                  </div>
                              </button>
                              <div class="dropdown-menu dropdown-menu-end profile-dropdown">
                                  <div class="dropdown-header d-flex align-items-center">
                                      <div class="avatar-circle me-3">
                                          <img src="https://randomuser.me/api/portraits/men/41.jpg" alt="Admin">
                                      </div>
                                      <div>
                                          <h6 class="mb-0">Admin User</h6>
                                          <small class="text-muted">Administrator</small>
                                      </div>
                                  </div>
                                  <div class="dropdown-divider"></div>
                                  <a class="dropdown-item" href="#">
                                      <i class="fas fa-user me-2"></i> My Profile
                                  </a>
                                  <a class="dropdown-item" href="#">
                                      <i class="fas fa-cog me-2"></i> Settings
                                  </a>
                                  <div class="dropdown-divider"></div>
                                  <a class="dropdown-item" href="#">
                                      <i class="fas fa-sign-out-alt me-2"></i> Logout
                                  </a>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </header>

          <!-- Breadcrumb -->
          <div class="breadcrumb-wrapper">
              <div class="container-fluid">
                  <nav aria-label="breadcrumb">
                      <ol class="breadcrumb">
                          <li class="breadcrumb-item">
                              <a href="/admin">Dashboard</a>
                          </li>
                          <li class="breadcrumb-item active" aria-current="page">Wallet Transactions</li>
                      </ol>
                  </nav>
              </div>
          </div>

          <!-- Main Content Area -->
          <div class="container-fluid py-3">
              <!-- Quick Actions & Filters -->
              <div class="row g-3 mb-3 fade-in">
                  <div class="col-xl-8">
                      <div class="card filter-card">
                          <div class="card-header">
                              <div class="d-flex justify-content-between align-items-center">
                                  <h5 class="card-title mb-0">Filter Transactions</h5>
                                  <button class="btn btn-sm btn-icon" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="true" aria-controls="filterCollapse">
                                      <i class="fas fa-chevron-down"></i>
                                  </button>
                              </div>
                          </div>
                          <div class="collapse show" id="filterCollapse">
                              <div class="card-body">
                                  <form id="filterForm" method="GET" class="row g-2">
                                      <div class="col-md-3">
                                          <div class="form-floating">
                                              <select class="form-select" id="type" name="type">
                                                  <option value="" <%= !filters.type ? 'selected' : '' %>>All Types</option>
                                                  <option value="credit" <%= filters.type === 'credit' ? 'selected' : '' %>>Credit</option>
                                                  <option value="debit" <%= filters.type === 'debit' ? 'selected' : '' %>>Debit</option>
                                              </select>
                                              <label for="type">Transaction Type</label>
                                          </div>
                                      </div>
                                      <div class="col-md-3">
                                          <div class="form-floating">
                                              <select class="form-select" id="timeRange" name="timeRange">
                                                  <option value="all" <%= filters.timeRange === 'all' ? 'selected' : '' %>>All Time</option>
                                                  <option value="24h" <%= filters.timeRange === '24h' ? 'selected' : '' %>>Last 24 Hours</option>
                                                  <option value="7d" <%= filters.timeRange === '7d' ? 'selected' : '' %>>Last 7 Days</option>
                                                  <option value="30d" <%= filters.timeRange === '30d' ? 'selected' : '' %>>Last 30 Days</option>
                                                  <option value="90d" <%= filters.timeRange === '90d' ? 'selected' : '' %>>Last 90 Days</option>
                                              </select>
                                              <label for="timeRange">Time Range</label>
                                          </div>
                                      </div>
                                      <div class="col-md-3">
                                          <div class="form-floating">
                                              <select class="form-select" id="sort" name="sort">
                                                  <option value="date" <%= filters.sort === 'date' ? 'selected' : '' %>>Date</option>
                                                  <option value="amount" <%= filters.sort === 'amount' ? 'selected' : '' %>>Amount</option>
                                              </select>
                                              <label for="sort">Sort By</label>
                                          </div>
                                      </div>
                                      <div class="col-md-3">
                                          <div class="form-floating">
                                              <select class="form-select" id="order" name="order">
                                                  <option value="desc" <%= filters.order === 'desc' ? 'selected' : '' %>>Descending</option>
                                                  <option value="asc" <%= filters.order === 'asc' ? 'selected' : '' %>>Ascending</option>
                                              </select>
                                              <label for="order">Order</label>
                                          </div>
                                      </div>
                                      <div class="col-md-6">
                                          <div class="form-floating">
                                              <input type="text" class="form-control" id="search" name="search" placeholder="Search by user name or email" value="<%= filters.search %>">
                                              <label for="search">Search</label>
                                          </div>
                                      </div>
                                      <div class="col-md-3">
                                          <div class="form-floating">
                                              <select class="form-select" id="limit" name="limit">
                                                  <option value="10" <%= filters.limit === 10 ? 'selected' : '' %>>10</option>
                                                  <option value="25" <%= filters.limit === 25 ? 'selected' : '' %>>25</option>
                                                  <option value="50" <%= filters.limit === 50 ? 'selected' : '' %>>50</option>
                                                  <option value="100" <%= filters.limit === 100 ? 'selected' : '' %>>100</option>
                                              </select>
                                              <label for="limit">Items Per Page</label>
                                          </div>
                                      </div>
                                      <div class="col-md-3 d-flex align-items-end">
                                          <button type="submit" class="btn btn-primary me-2">
                                              <i class="fas fa-filter me-1"></i>Apply
                                          </button>
                                          <a href="/admin/wallet-transactions" class="btn btn-outline-secondary">
                                              <i class="fas fa-redo me-1"></i>Reset
                                          </a>
                                      </div>
                                  </form>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="col-xl-4">
                      <div class="card">
                          <div class="card-header">
                              <h5 class="card-title mb-0">Quick Actions</h5>
                          </div>
                          <div class="card-body">
                              <div class="quick-actions">
                                  <a href="/admin/refund-transactions" class="quick-action-item">
                                      <div class="quick-action-icon bg-primary-soft">
                                          <i class="fas fa-undo text-primary"></i>
                                      </div>
                                      <span class="quick-action-text">View Refunds</span>
                                  </a>
                                  <a href="/admin/refund-statistics" class="quick-action-item">
                                      <div class="quick-action-icon bg-success-soft">
                                          <i class="fas fa-chart-bar text-success"></i>
                                      </div>
                                      <span class="quick-action-text">Refund Stats</span>
                                  </a>
                                  <a href="#" class="quick-action-item" id="exportTransactions">
                                      <div class="quick-action-icon bg-info-soft">
                                          <i class="fas fa-file-export text-primary"></i>
                                      </div>
                                      <span class="quick-action-text">Export Data</span>
                                  </a>
                                  <a href="#" class="quick-action-item" data-bs-toggle="modal" data-bs-target="#settingsModal">
                                      <div class="quick-action-icon bg-warning-soft">
                                          <i class="fas fa-cog text-warning"></i>
                                      </div>
                                      <span class="quick-action-text">Settings</span>
                                  </a>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Quick Filters -->
              <div class="quick-filters mb-3 fade-in">
                  <button class="btn btn-quick-filter active" data-filter="all">
                      <i class="fas fa-list me-1"></i>All
                  </button>
                  <button class="btn btn-quick-filter" data-filter="credit">
                      <i class="fas fa-arrow-up me-1"></i>Credits
                  </button>
                  <button class="btn btn-quick-filter" data-filter="debit">
                      <i class="fas fa-arrow-down me-1"></i>Debits
                  </button>
                  <button class="btn btn-quick-filter" data-filter="refund">
                      <i class="fas fa-undo-alt me-1"></i>Refunds
                  </button>
                  <button class="btn btn-quick-filter" data-filter="today">
                      <i class="fas fa-calendar-day me-1"></i>Today
                  </button>
                  <button class="btn btn-quick-filter" data-filter="week">
                      <i class="fas fa-calendar-week me-1"></i>This Week
                  </button>
              </div>

              <!-- Transactions Table Card -->
              <div class="card transactions-card fade-in">
                  <div class="card-header">
                      <div class="d-flex justify-content-between align-items-center">
                          <h5 class="card-title mb-0">Wallet Transactions</h5>
                          <div class="table-actions">
                              <button class="btn btn-sm btn-outline-secondary me-2" id="refreshTable">
                                  <i class="fas fa-sync-alt me-1"></i> Refresh
                              </button>
                              <div class="dropdown">
                                  <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                      <i class="fas fa-cog me-1"></i> Options
                                  </button>
                                  <ul class="dropdown-menu dropdown-menu-end">
                                      <li><a class="dropdown-item" href="#"><i class="fas fa-file-export me-2"></i> Export CSV</a></li>
                                      <li><a class="dropdown-item" href="#"><i class="fas fa-file-pdf me-2"></i> Export PDF</a></li>
                                      <li><a class="dropdown-item" href="#"><i class="fas fa-print me-2"></i> Print</a></li>
                                      <li><hr class="dropdown-divider"></li>
                                      <li><a class="dropdown-item" href="#"><i class="fas fa-columns me-2"></i> Manage Columns</a></li>
                                  </ul>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="card-body p-0">
                      <div class="table-responsive">
                          <table class="table table-hover transactions-table mb-0">
                              <thead>
                                  <tr>
                                      <th>
                                          <div class="form-check">
                                              <input class="form-check-input" type="checkbox" id="selectAll">
                                              <label class="form-check-label" for="selectAll"></label>
                                          </div>
                                      </th>
                                      <th>User</th>
                                      <th>Type</th>
                                      <th>Amount</th>
                                      <th>Description</th>
                                      <th>Transaction ID</th>
                                      <th>Date</th>
                                      <th>Actions</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <% if (transactions.length === 0) { %>
                                      <tr>
                                          <td colspan="8" class="text-center py-4">
                                              <div class="empty-state">
                                                  <div class="empty-state-icon">
                                                      <i class="fas fa-search"></i>
                                                  </div>
                                                  <h5>No transactions found</h5>
                                                  <p class="text-muted">Try adjusting your search or filter criteria</p>
                                                  <button class="btn btn-primary btn-sm">Clear Filters</button>
                                              </div>
                                          </td>
                                      </tr>
                                  <% } else { %>
                                      <% transactions.forEach(transaction => { %>
                                          <tr class="transaction-row" data-type="<%= transaction.type %>" <%= transaction.isRefund ? 'data-refund="true"' : '' %>>
                                              <td>
                                                  <div class="form-check">
                                                      <input class="form-check-input transaction-checkbox" type="checkbox" id="transaction<%= transaction._id %>">
                                                      <label class="form-check-label" for="transaction<%= transaction._id %>"></label>
                                                  </div>
                                              </td>
                                              <td>
                                                  <div class="d-flex align-items-center">
                                                      <div class="avatar-circle <%= transaction.type === 'credit' ? 'bg-success-soft' : 'bg-danger-soft' %>">
                                                          <%= transaction.userFullname.charAt(0).toUpperCase() %>
                                                      </div>
                                                      <div class="ms-2">
                                                          <div class="d-flex align-items-center">
                                                              <strong><%= transaction.userFullname %></strong>
                                                              <% if (transaction.isVIP) { %>
                                                                  <span class="badge bg-warning-soft text-warning ms-1">VIP</span>
                                                              <% } %>
                                                          </div>
                                                          <div class="text-muted small"><%= transaction.userEmail %></div>
                                                      </div>
                                                  </div>
                                              </td>
                                              <td>
                                                  <span class="badge rounded-pill <%= transaction.type === 'credit' ? 'bg-success-soft text-success' : 'bg-danger-soft text-danger' %>">
                                                      <i class="fas <%= transaction.type === 'credit' ? 'fa-arrow-up' : 'fa-arrow-down' %> me-1"></i>
                                                      <%= transaction.type === 'credit' ? 'Credit' : 'Debit' %>
                                                      <% if (transaction.isRefund) { %>
                                                          <i class="fas fa-undo-alt ms-1" title="<%= transaction.refundTypeDisplay || 'Refund' %>"></i>
                                                      <% } %>
                                                  </span>
                                              </td>
                                              <td class="fw-bold <%= transaction.type === 'credit' ? 'text-success' : 'text-danger' %>">
                                                  <%= transaction.type === 'credit' ? '+' : '-' %>₹<%= transaction.amount.toFixed(2) %>
                                              </td>
                                              <td>
                                                  <div class="description-cell">
                                                      <%= transaction.description %>
                                                  </div>
                                              </td>
                                              <td>
                                                  <div class="transaction-id-wrapper">
                                                      <span class="transaction-id"><%= transaction.transactionRef %></span>
                                                      <button class="btn btn-sm btn-icon copy-btn" data-clipboard-text="<%= transaction.transactionRef %>" title="Copy to clipboard">
                                                          <i class="fas fa-copy"></i>
                                                      </button>
                                                  </div>
                                              </td>
                                              <td>
                                                  <div class="d-flex flex-column">
                                                      <span><%= transaction.formattedDate.split(' ')[0] %></span>
                                                      <small class="text-muted"><%= transaction.formattedDate.split(' ')[1] %></small>
                                                  </div>
                                              </td>
                                              <td>
                                                  <div class="dropdown">
                                                      <button class="btn btn-sm btn-icon" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                          <i class="fas fa-ellipsis-v"></i>
                                                      </button>
                                                      <ul class="dropdown-menu dropdown-menu-end">
                                                          <li>
                                                              <a class="dropdown-item" href="/admin/user-wallet/<%= transaction.userId %>">
                                                                  <i class="fas fa-wallet me-2"></i> View Wallet
                                                              </a>
                                                          </li>
                                                          <% if (transaction.isRefund) { %>
                                                              <li>
                                                                  <a class="dropdown-item view-refund-details" href="#" data-transaction-ref="<%= transaction.transactionRef %>">
                                                                      <i class="fas fa-info-circle me-2"></i> View Details
                                                                  </a>
                                                              </li>
                                                          <% } %>
                                                          <li>
                                                              <a class="dropdown-item" href="/admin/users/<%= transaction.userId %>">
                                                                  <i class="fas fa-user me-2"></i> View User
                                                              </a>
                                                          </li>
                                                          <li><hr class="dropdown-divider"></li>
                                                          <li>
                                                              <a class="dropdown-item text-danger" href="#">
                                                                  <i class="fas fa-trash-alt me-2"></i> Delete Record
                                                              </a>
                                                          </li>
                                                      </ul>
                                                  </div>
                                              </td>
                                          </tr>
                                      <% }); %>
                                  <% } %>
                              </tbody>
                          </table>
                      </div>
                  </div>
                  <div class="card-footer">
                      <div class="d-flex flex-wrap justify-content-between align-items-center">
                          <div class="pagination-info">
                              <div class="d-flex align-items-center">
                                  <div class="me-3">
                                      <span class="fw-bold"><%= transactions.length %></span> of <span class="fw-bold"><%= totalTransactions %></span> transactions
                                  </div>
                                  <div class="bulk-actions">
                                      <button class="btn btn-sm btn-outline-primary me-2 bulk-action-btn" disabled>
                                          <i class="fas fa-file-export me-1"></i> Export Selected
                                      </button>
                                      <button class="btn btn-sm btn-outline-danger bulk-action-btn" disabled>
                                          <i class="fas fa-trash-alt me-1"></i> Delete Selected
                                      </button>
                                  </div>
                              </div>
                          </div>
                          <% if (totalPages > 1) { %>
                              <nav aria-label="Page navigation">
                                  <ul class="pagination pagination-sm mb-0">
                                      <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                          <a class="page-link" href="?page=<%= currentPage - 1 %>&type=<%= filters.type %>&search=<%= filters.search %>&sort=<%= filters.sort %>&order=<%= filters.order %>&timeRange=<%= filters.timeRange %>&limit=<%= filters.limit %>">
                                              <i class="fas fa-chevron-left"></i>
                                          </a>
                                      </li>
                                      <% for (let i = 1; i <= totalPages; i++) { %>
                                          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                              <a class="page-link" href="?page=<%= i %>&type=<%= filters.type %>&search=<%= filters.search %>&sort=<%= filters.sort %>&order=<%= filters.order %>&timeRange=<%= filters.timeRange %>&limit=<%= filters.limit %>"><%= i %></a>
                                          </li>
                                      <% } %>
                                      <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                          <a class="page-link" href="?page=<%= currentPage + 1 %>&type=<%= filters.type %>&search=<%= filters.search %>&sort=<%= filters.sort %>&order=<%= filters.order %>&timeRange=<%= filters.timeRange %>&limit=<%= filters.limit %>">
                                              <i class="fas fa-chevron-right"></i>
                                          </a>
                                      </li>
                                  </ul>
                              </nav>
                          <% } %>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Refund Details Modal -->
<div class="modal fade" id="refundDetailsModal" tabindex="-1" aria-labelledby="refundDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="refundDetailsModalLabel">
                  <i class="fas fa-undo-alt me-2"></i>Refund Details
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div id="refundDetailsContent">
                  <div class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                          <span class="visually-hidden">Loading...</span>
                      </div>
                      <p class="mt-2">Loading refund details...</p>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

<!-- Export Options Modal -->
<div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="exportModalLabel">
                  <i class="fas fa-file-export me-2"></i>Export Transactions
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-3">
                  <label for="exportFormat" class="form-label">Export Format</label>
                  <select class="form-select" id="exportFormat">
                      <option value="csv">CSV</option>
                      <option value="excel">Excel</option>
                      <option value="pdf">PDF</option>
                      <option value="json">JSON</option>
                  </select>
              </div>
              <div class="mb-3">
                  <label for="exportRange" class="form-label">Date Range</label>
                  <select class="form-select" id="exportRange">
                      <option value="all">All Time</option>
                      <option value="current">Current View</option>
                      <option value="custom">Custom Range</option>
                  </select>
              </div>
              <div class="mb-3 export-custom-range d-none">
                  <div class="row">
                      <div class="col-md-6">
                          <label for="exportStartDate" class="form-label">Start Date</label>
                          <input type="date" class="form-control" id="exportStartDate">
                      </div>
                      <div class="col-md-6">
                          <label for="exportEndDate" class="form-label">End Date</label>
                          <input type="date" class="form-control" id="exportEndDate">
                      </div>
                  </div>
              </div>
              <div class="mb-3">
                  <label for="exportColumns" class="form-label">Columns to Export</label>
                  <div class="export-columns">
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="colUser" checked>
                          <label class="form-check-label" for="colUser">User</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="colType" checked>
                          <label class="form-check-label" for="colType">Type</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="colAmount" checked>
                          <label class="form-check-label" for="colAmount">Amount</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="colDescription" checked>
                          <label class="form-check-label" for="colDescription">Description</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="colTransactionId" checked>
                          <label class="form-check-label" for="colTransactionId">Transaction ID</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="colDate" checked>
                          <label class="form-check-label" for="colDate">Date</label>
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="confirmExport">
                  <i class="fas fa-download me-2"></i>Export
              </button>
          </div>
      </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="settingsModalLabel">
                  <i class="fas fa-cog me-2"></i>Settings
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-3">
                  <h6 class="settings-section-title">Display Options</h6>
                  <div class="form-check form-switch mb-2">
                      <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                      <label class="form-check-label" for="darkModeSwitch">Dark Mode</label>
                  </div>
                  <div class="form-check form-switch mb-2">
                      <input class="form-check-input" type="checkbox" id="compactViewSwitch" checked>
                      <label class="form-check-label" for="compactViewSwitch">Compact View</label>
                  </div>
                  <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="animationsSwitch" checked>
                      <label class="form-check-label" for="animationsSwitch">Enable Animations</label>
                  </div>
              </div>
              <div class="mb-3">
                  <h6 class="settings-section-title">Table Columns</h6>
                  <div class="settings-columns">
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="showUser" checked>
                          <label class="form-check-label" for="showUser">User</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="showType" checked>
                          <label class="form-check-label" for="showType">Type</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="showAmount" checked>
                          <label class="form-check-label" for="showAmount">Amount</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="showDescription" checked>
                          <label class="form-check-label" for="showDescription">Description</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="showTransactionId" checked>
                          <label class="form-check-label" for="showTransactionId">Transaction ID</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="showDate" checked>
                          <label class="form-check-label" for="showDate">Date</label>
                      </div>
                  </div>
              </div>
              <div>
                  <h6 class="settings-section-title">Notifications</h6>
                  <div class="form-check form-switch mb-2">
                      <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                      <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                  </div>
                  <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="browserNotifications">
                      <label class="form-check-label" for="browserNotifications">Browser Notifications</label>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="saveSettings">
                  <i class="fas fa-save me-2"></i>Save Settings
              </button>
          </div>
      </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Initialize clipboard.js
      new ClipboardJS('.copy-btn').on('success', function(e) {
          const button = e.trigger;
          button.innerHTML = '<i class="fas fa-check"></i>';
          setTimeout(() => {
              button.innerHTML = '<i class="fas fa-copy"></i>';
          }, 2000);
      });

      // View refund details
      const viewRefundButtons = document.querySelectorAll('.view-refund-details');
      const refundDetailsModal = new bootstrap.Modal(document.getElementById('refundDetailsModal'));
      const refundDetailsContent = document.getElementById('refundDetailsContent');

      viewRefundButtons.forEach(button => {
          button.addEventListener('click', function(e) {
              e.preventDefault();
              const transactionRef = this.getAttribute('data-transaction-ref');
              
              // Show loading state
              refundDetailsContent.innerHTML = `
                  <div class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                          <span class="visually-hidden">Loading...</span>
                      </div>
                      <p class="mt-2">Loading refund details...</p>
                  </div>
              `;
              
              refundDetailsModal.show();
              
              // Fetch refund details
              fetch(`/admin/refund-details/${transactionRef}`)
                  .then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          const transaction = data.transaction;
                          const user = data.user;
                          const orderItem = data.orderItem;
                          const order = data.order;
                          
                          let html = `
                              <div class="refund-details">
                                  <div class="card mb-3 border-0 shadow-sm">
                                      <div class="card-header bg-light">
                                          <h6 class="mb-0"><i class="fas fa-exchange-alt me-2"></i>Transaction Information</h6>
                                      </div>
                                      <div class="card-body">
                                          <div class="row">
                                              <div class="col-md-6">
                                                  <div class="detail-item">
                                                      <span class="detail-label">Transaction ID</span>
                                                      <span class="detail-value">${transaction.transactionRef}</span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Type</span>
                                                      <span class="detail-value">
                                                          <span class="badge rounded-pill ${transaction.type === 'credit' ? 'bg-success-soft text-success' : 'bg-danger-soft text-danger'}">
                                                              <i class="fas ${transaction.type === 'credit' ? 'fa-arrow-up' : 'fa-arrow-down'} me-1"></i>
                                                              ${transaction.type === 'credit' ? 'Credit' : 'Debit'}
                                                          </span>
                                                      </span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Amount</span>
                                                      <span class="detail-value fw-bold ${transaction.type === 'credit' ? 'text-success' : 'text-danger'}">
                                                          ${transaction.type === 'credit' ? '+' : '-'}₹${transaction.amount.toFixed(2)}
                                                      </span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Date</span>
                                                      <span class="detail-value">${transaction.formattedDate}</span>
                                                  </div>
                                              </div>
                                              <div class="col-md-6">
                                                  <div class="detail-item">
                                                      <span class="detail-label">Refund Type</span>
                                                      <span class="detail-value">${transaction.refundTypeDisplay || 'Standard Refund'}</span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Description</span>
                                                      <span class="detail-value">${transaction.description}</span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Status</span>
                                                      <span class="detail-value">
                                                          <span class="badge bg-success-soft text-success">
                                                              <i class="fas fa-check-circle me-1"></i>
                                                              ${transaction.status || 'Completed'}
                                                          </span>
                                                      </span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Order Reference</span>
                                                      <span class="detail-value">${transaction.orderReference || 'N/A'}</span>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                                  
                                  <div class="card mb-3 border-0 shadow-sm">
                                      <div class="card-header bg-light">
                                          <h6 class="mb-0"><i class="fas fa-user me-2"></i>User Information</h6>
                                      </div>
                                      <div class="card-body">
                                          <div class="user-info">
                                              <div class="d-flex align-items-center mb-3">
                                                  <div class="avatar-circle bg-primary-soft me-3">
                                                      ${user.fullname.charAt(0).toUpperCase()}
                                                  </div>
                                                  <div>
                                                      <h6 class="mb-0">${user.fullname}</h6>
                                                      <p class="text-muted mb-0">${user.email}</p>
                                                  </div>
                                              </div>
                                              <div class="detail-item">
                                                  <span class="detail-label">User ID</span>
                                                  <span class="detail-value">${user._id}</span>
                                              </div>
                                              <div class="mt-3">
                                                  <a href="/admin/user-wallet/${user._id}" class="btn btn-sm btn-primary">
                                                      <i class="fas fa-wallet me-2"></i>View User's Wallet
                                                  </a>
                                                  <a href="/admin/users/${user._id}" class="btn btn-sm btn-outline-secondary ms-2">
                                                      <i class="fas fa-user me-2"></i>View User Profile
                                                  </a>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              `;
                          
                          if (orderItem) {
                              html += `
                                  <div class="card mb-3 border-0 shadow-sm">
                                      <div class="card-header bg-light">
                                          <h6 class="mb-0"><i class="fas fa-box me-2"></i>Product Information</h6>
                                      </div>
                                      <div class="card-body">
                                          <div class="row">
                                              <div class="col-md-3">
                                                  <div class="product-image-container">
                                                      <img src="${orderItem.itemImage || '/placeholder.jpg'}" alt="${orderItem.product_name}" class="img-fluid rounded product-image">
                                                  </div>
                                              </div>
                                              <div class="col-md-9">
                                                  <h5 class="product-name">${orderItem.product_name}</h5>
                                                  <div class="product-details">
                                                      <div class="row">
                                                          <div class="col-md-6">
                                                              <div class="detail-item">
                                                                  <span class="detail-label">Size</span>
                                                                  <span class="detail-value">${orderItem.size}</span>
                                                              </div>
                                                              <div class="detail-item">
                                                                  <span class="detail-label">Price</span>
                                                                  <span class="detail-value">₹${orderItem.price.toFixed(2)}</span>
                                                              </div>
                                                              <div class="detail-item">
                                                                  <span class="detail-label">Quantity</span>
                                                                  <span class="detail-value">${orderItem.quantity}</span>
                                                              </div>
                                                          </div>
                                                          <div class="col-md-6">
                                                              <div class="detail-item">
                                                                  <span class="detail-label">Total Amount</span>
                                                                  <span class="detail-value">₹${orderItem.total_amount.toFixed(2)}</span>
                                                              </div>
                                                              <div class="detail-item">
                                                                  <span class="detail-label">Refund Amount</span>
                                                                  <span class="detail-value fw-bold text-success">₹${orderItem.refundAmount.toFixed(2)}</span>
                                                              </div>
                                                              <div class="detail-item">
                                                                  <span class="detail-label">Refund Date</span>
                                                                  <span class="detail-value">${new Date(orderItem.refundDate).toLocaleString()}</span>
                                                              </div>
                                                          </div>
                                                      </div>
                                                      ${orderItem.refundReason ? `
                                                          <div class="refund-reason mt-3">
                                                              <h6>Refund Reason:</h6>
                                                              <p class="mb-0 p-2 bg-light rounded">${orderItem.refundReason}</p>
                                                          </div>
                                                      ` : ''}
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              `;
                          }
                          
                          if (order) {
                              html += `
                                  <div class="card border-0 shadow-sm">
                                      <div class="card-header bg-light">
                                          <h6 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Order Information</h6>
                                      </div>
                                      <div class="card-body">
                                          <div class="row">
                                              <div class="col-md-6">
                                                  <div class="detail-item">
                                                      <span class="detail-label">Order Number</span>
                                                      <span class="detail-value">${order.orderNumber}</span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Order Date</span>
                                                      <span class="detail-value">${new Date(order.orderDate).toLocaleString()}</span>
                                                  </div>
                                              </div>
                                              <div class="col-md-6">
                                                  <div class="detail-item">
                                                      <span class="detail-label">Order Status</span>
                                                      <span class="detail-value">
                                                          <span class="badge bg-${getStatusColor(order.status)}-soft text-${getStatusColor(order.status)}">
                                                              ${order.status}
                                                          </span>
                                                      </span>
                                                  </div>
                                                  <div class="detail-item">
                                                      <span class="detail-label">Payment Method</span>
                                                      <span class="detail-value">${order.paymentMethod}</span>
                                                  </div>
                                              </div>
                                          </div>
                                          <div class="mt-3">
                                              <a href="/admin/orders/${order._id}" class="btn btn-sm btn-primary">
                                                  <i class="fas fa-eye me-2"></i>View Order Details
                                              </a>
                                          </div>
                                      </div>
                                  </div>
                              `;
                          }
                          
                          html += `</div>`;
                          
                          refundDetailsContent.innerHTML = html;
                      } else {
                          refundDetailsContent.innerHTML = `
                              <div class="alert alert-danger">
                                  <i class="fas fa-exclamation-circle me-2"></i>
                                  ${data.message || 'Failed to load refund details'}
                              </div>
                          `;
                      }
                  })
                  .catch(error => {
                      console.error('Error fetching refund details:', error);
                      refundDetailsContent.innerHTML = `
                          <div class="alert alert-danger">
                              <i class="fas fa-exclamation-circle me-2"></i>
                              An error occurred while loading refund details
                          </div>
                      `;
                  });
          });
      });

      // Handle checkbox selection for bulk actions
      const selectAllCheckbox = document.getElementById('selectAll');
      const transactionCheckboxes = document.querySelectorAll('.transaction-checkbox');
      const bulkActionBtns = document.querySelectorAll('.bulk-action-btn');

      selectAllCheckbox.addEventListener('change', function() {
          const isChecked = this.checked;
          transactionCheckboxes.forEach(checkbox => {
              checkbox.checked = isChecked;
          });
          updateBulkActionButtons();
      });

      transactionCheckboxes.forEach(checkbox => {
          checkbox.addEventListener('change', updateBulkActionButtons);
      });

      function updateBulkActionButtons() {
          const checkedCount = document.querySelectorAll('.transaction-checkbox:checked').length;
          bulkActionBtns.forEach(btn => {
              btn.disabled = checkedCount === 0;
              if (checkedCount > 0) {
                  btn.innerHTML = btn.innerHTML.replace(/\s$$\d+$$$/g, '') + ` (${checkedCount})`;
              } else {
                  btn.innerHTML = btn.innerHTML.replace(/\s$$\d+$$$/g, '');
              }
          });
      }

      // Quick filters
      const quickFilterBtns = document.querySelectorAll('.btn-quick-filter');
      quickFilterBtns.forEach(btn => {
          btn.addEventListener('click', function() {
              quickFilterBtns.forEach(b => b.classList.remove('active'));
              this.classList.add('active');
              
              const filter = this.getAttribute('data-filter');
              const rows = document.querySelectorAll('.transaction-row');
              
              rows.forEach(row => {
                  if (filter === 'all') {
                      row.classList.remove('d-none');
                  } else if (filter === 'refund') {
                      if (row.getAttribute('data-refund') === 'true') {
                          row.classList.remove('d-none');
                      } else {
                          row.classList.add('d-none');
                      }
                  } else if (filter === 'credit' || filter === 'debit') {
                      if (row.getAttribute('data-type') === filter) {
                          row.classList.remove('d-none');
                      } else {
                          row.classList.add('d-none');
                      }
                  } else if (filter === 'today') {
                      // Implementation for today's transactions would go here
                      row.classList.remove('d-none');
                  } else if (filter === 'week') {
                      // Implementation for this week's transactions would go here
                      row.classList.remove('d-none');
                  }
              });
          });
      });

      // Export modal
      const exportTransactionsBtn = document.getElementById('exportTransactions');
      const exportModal = new bootstrap.Modal(document.getElementById('exportModal'));
      
      exportTransactionsBtn.addEventListener('click', function() {
          exportModal.show();
      });

      // Handle export range change
      const exportRange = document.getElementById('exportRange');
      const exportCustomRange = document.querySelector('.export-custom-range');
      
      exportRange.addEventListener('change', function() {
          if (this.value === 'custom') {
              exportCustomRange.classList.remove('d-none');
          } else {
              exportCustomRange.classList.add('d-none');
          }
      });

      // Dark mode toggle
      const darkModeSwitch = document.getElementById('darkModeSwitch');
      darkModeSwitch.addEventListener('change', function() {
          document.body.classList.toggle('dark-mode', this.checked);
          localStorage.setItem('darkMode', this.checked ? 'enabled' : 'disabled');
      });

      // Check for saved dark mode preference
      const savedDarkMode = localStorage.getItem('darkMode');
      if (savedDarkMode === 'enabled') {
          darkModeSwitch.checked = true;
          document.body.classList.add('dark-mode');
      }

      // Settings save button
      const saveSettingsBtn = document.getElementById('saveSettings');
      saveSettingsBtn.addEventListener('click', function() {
          // Save settings logic would go here
          const settingsModal = bootstrap.Modal.getInstance(document.getElementById('settingsModal'));
          
          // Show success toast
          const toast = document.createElement('div');
          toast.className = 'toast-notification success';
          toast.innerHTML = `
              <div class="toast-icon">
                  <i class="fas fa-check-circle"></i>
              </div>
              <div class="toast-content">
                  <p>Settings saved successfully!</p>
              </div>
              <button class="toast-close">
                  <i class="fas fa-times"></i>
              </button>
          `;
          document.body.appendChild(toast);
          
          setTimeout(() => {
              toast.classList.add('show');
              setTimeout(() => {
                  toast.classList.remove('show');
                  setTimeout(() => {
                      toast.remove();
                  }, 300);
              }, 3000);
          }, 100);
          
          settingsModal.hide();
      });

      // Helper function to get status color
      function getStatusColor(status) {
          switch(status.toLowerCase()) {
              case 'completed':
              case 'delivered':
                  return 'success';
              case 'processing':
              case 'shipped':
                  return 'info';
              case 'pending':
                  return 'warning';
              case 'cancelled':
              case 'failed':
                  return 'danger';
              default:
                  return 'secondary';
          }
      }

      // Add fade-in animation to elements
      document.querySelectorAll('.fade-in').forEach((element, index) => {
          setTimeout(() => {
              element.style.opacity = '1';
              element.style.transform = 'translateY(0)';
          }, index * 100);
      });
  });
</script>
</body>
</html>