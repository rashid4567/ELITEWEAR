<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Wear Admin - Banner Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/adminStyle/banner-management.css">
</head>
<body>
    <%- include("../partials/admin/header") %>  

    <div class="main-content">
        <div class="page-header">
            <div>
                <h2>Banner Management</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/admin/">Dashboard</a></li>
                        <li class="breadcrumb-item active">Banners</li>
                    </ol>
                </nav>
            </div>
            <div class="user-profile">
                <img src="/api/placeholder/40/40" alt="User Avatar">
                <div>
                    <div>Aimad</div>
                    <small class="text-muted">Admin</small>
                </div>
            </div>
        </div>

        <div class="search-sort-filter">
            <div class="search-container">
                <i class="bi bi-search"></i>
                <input type="text" class="form-control" id="searchBanner" placeholder="Search banner by title...">
            </div>
            
            <div class="dropdown sort-dropdown">
                <button class="btn dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-sort-down me-2"></i> Sort By
                </button>
                <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                    <li><a class="dropdown-item" href="#" data-sort="days-desc">More days left</a></li>
                    <li><a class="dropdown-item" href="#" data-sort="days-asc">Less days left</a></li>
                    <li><a class="dropdown-item" href="#" data-sort="date-desc">Newest first</a></li>
                    <li><a class="dropdown-item" href="#" data-sort="date-asc">Oldest first</a></li>
                </ul>
            </div>
            
            <div class="filter-pills">
                <button class="btn active" data-filter="all">All</button>
                <button class="btn" data-filter="active">Active</button>
                <button class="btn" data-filter="upcoming">Upcoming</button>
                <button class="btn" data-filter="expired">Expired</button>
            </div>
        </div>

        <div class="banner-table">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Title</th>
                        <th>Starting Date</th>
                        <th>Ending Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if(data && data.length > 0) { %>
                        <% data.forEach(banner => { %>
                            <tr data-status="<%= banner.status.toLowerCase().includes('upcoming') ? 'upcoming' : banner.status.toLowerCase().includes('expired') ? 'expired' : 'active' %>">
                                <td><img src="<%= banner.image ? banner.image : 'https://via.placeholder.com/60' %>" alt="<%= banner.title %>"></td>
                                <td><%= banner.title %></td>
                                <td><%= banner.startingDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></td>
                                <td><%= banner.endingDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></td>
                                <td>
                                    <% if(banner.status.toLowerCase().includes('upcoming')) { %>
                                        <span class="status-badge status-upcoming"><i class="bi bi-clock me-1"></i><%= banner.status %></span>
                                    <% } else if(banner.status.toLowerCase().includes('expired')) { %>
                                        <span class="status-badge status-expired"><i class="bi bi-x-circle me-1"></i><%= banner.status %></span>
                                    <% } else { %>
                                        <span class="status-badge status-active"><i class="bi bi-check-circle me-1"></i><%= banner.status %></span>
                                    <% } %>
                                </td>
                                <td class="action-buttons">
                                    <a class="edit" href="/admin/editBaner?id=<%= banner._id %>" title="Edit Banner">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a class="delete" href="/admin/deleteBaner?id=<%= banner._id %>" title="Delete Banner" onclick="return confirm('Are you sure you want to delete this banner?')">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <div class="empty-state">
                                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                                    <p class="mt-2">No banners found</p>
                                </div>
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
        
        <a href="/admin/addBanner" class="add-banner-btn">
            <i class="bi bi-plus-lg me-2"></i> ADD NEW BANNER
        </a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Search functionality
        document.getElementById('searchBanner').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const title = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
        
        // Filter functionality
        document.querySelectorAll('.filter-pills .btn').forEach(button => {
            button.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('.filter-pills .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                const filter = this.getAttribute('data-filter');
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    if (filter === 'all') {
                        row.style.display = '';
                    } else {
                        const status = row.getAttribute('data-status');
                        if (status === filter) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                });
            });
        });
        
        // Sort functionality
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const sortType = this.getAttribute('data-sort');
                const rows = Array.from(document.querySelectorAll('tbody tr'));
                
                rows.sort((a, b) => {
                    if (sortType === 'days-desc' || sortType === 'days-asc') {
                        const statusA = a.querySelector('td:nth-child(5)').textContent.trim();
                        const statusB = b.querySelector('td:nth-child(5)').textContent.trim();
                        
                        const daysA = parseInt(statusA.match(/\d+/) || [0]);
                        const daysB = parseInt(statusB.match(/\d+/) || [0]);
                        
                        return sortType === 'days-desc' ? daysB - daysA : daysA - daysB;
                    } else if (sortType === 'date-desc' || sortType === 'date-asc') {
                        const dateA = new Date(a.querySelector('td:nth-child(3)').textContent);
                        const dateB = new Date(b.querySelector('td:nth-child(3)').textContent);
                        
                        return sortType === 'date-desc' ? dateB - dateA : dateA - dateB;
                    }
                    return 0;
                });
                
                const tbody = document.querySelector('tbody');
                rows.forEach(row => tbody.appendChild(row));
                
                // Update dropdown button text
                document.getElementById('sortDropdown').innerHTML = `<i class="bi bi-sort-down me-2"></i> ${this.textContent}`;
            });
        });
    </script>
</body>
</html>
