<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password | ELITE WEAR</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/userStyle/forgotpassword.css">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/images/favicon.png" type="image/png">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="forgot-password-wrapper">
      <!-- Animated Background -->
      <div class="animated-background">
          <div class="gradient-bg"></div>
          <div class="particles">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
              <span></span>
              <span></span>
          </div>
      </div>
      
      <div class="container">
          <div class="row justify-content-center">
              <div class="col-lg-10">
                  <div class="forgot-password-card">
                      <div class="row">
                          <!-- Brand Panel (Left Side) -->
                          <div class="col-lg-5 d-none d-lg-block">
                              <div class="brand-panel">
                                  <div class="brand-content">
                                      <div class="logo-container">
                                          <div class="brand-logo">
                                              <span class="brand-logo-text">E</span>
                                          </div>
                                          <h1 class="brand-name">ELITE WEAR</h1>
                                      </div>
                                      <p class="brand-tagline">Redefining Luxury Fashion</p>
                                      
                                      
                                      
                                      <div class="security-badge">
                                          <i class="fas fa-shield-alt"></i>
                                          <span>Secure Password Recovery</span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          
                          <!-- Form Panel (Right Side) -->
                          <div class="col-lg-7">
                              <div class="form-panel">
                                  <!-- Mobile Logo (visible only on small screens) -->
                                  <div class="mobile-logo d-flex d-lg-none">
                                      <div class="brand-logo">
                                          <span class="brand-logo-text">E</span>
                                      </div>
                                      <h2 class="brand-name">ELITE WEAR</h2>
                                  </div>
                                  
                                  <div class="form-content">
                                      <h2 class="form-title">Forgot Your Password?</h2>
                                      <p class="form-subtitle">Enter your email address and we'll send you instructions to reset your password.</p>
                                      
                                      <!-- Alert messages -->
                                      <% if (typeof message !== 'undefined' && message) { %>
                                          <div class="alert <%= message.includes('success') ? 'alert-success' : 'alert-danger' %> alert-dismissible fade show" role="alert">
                                              <i class="fas <%= message.includes('success') ? 'fa-check-circle' : 'fa-exclamation-circle' %> me-2"></i>
                                              <%= message %>
                                              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                          </div>
                                      <% } %>
                                      
                                      <!-- Step Indicator -->
                                      <div class="step-indicator">
                                          <div class="step active">
                                              <div class="step-number">1</div>
                                              <div class="step-label">Email</div>
                                          </div>
                                          <div class="step-connector"></div>
                                          <div class="step">
                                              <div class="step-number">2</div>
                                              <div class="step-label">Verify</div>
                                          </div>
                                          <div class="step-connector"></div>
                                          <div class="step">
                                              <div class="step-number">3</div>
                                              <div class="step-label">Reset</div>
                                          </div>
                                      </div>
                                      
                                      <!-- Form -->
                                      <form id="forgotPasswordForm" action="/forgot-password" method="POST" class="mt-4">
                                          <div class="form-group mb-4">
                                              <label for="email" class="form-label">Email Address</label>
                                              <div class="input-group">
                                                  <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                                  <input 
                                                      type="email" 
                                                      class="form-control" 
                                                      id="email" 
                                                      name="email" 
                                                      placeholder="your@email.com"
                                                      value="<%= typeof email !== 'undefined' ? email : '' %>"
                                                      required
                                                  >
                                              </div>
                                              <div class="invalid-feedback" id="emailError"></div>
                                          </div>
                                          
                                          <div class="form-actions">
                                              <button type="submit" class="btn btn-primary">
                                                  <span>Send Reset Instructions</span>
                                                  <i class="fas fa-arrow-right ms-2"></i>
                                              </button>
                                          </div>
                                      </form>
                                      
                                      <div class="form-footer">
                                          <p>Remember your password? <a href="/login" class="link-primary">Sign in</a></p>
                                          <a href="/" class="back-link">
                                              <i class="fas fa-chevron-left me-2"></i>
                                              <span>Back to home</span>
                                          </a>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Custom JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        
        // Form validation
        forgotPasswordForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Always prevent default form submission
            
            let isValid = true;
            
            // Email validation
            const emailValue = emailInput.value.trim();
            const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            
            if (emailValue === '') {
                showError(emailInput, emailError, 'Please enter your email address');
                isValid = false;
            } else if (!emailPattern.test(emailValue)) {
                showError(emailInput, emailError, 'Please enter a valid email address');
                isValid = false;
            } else {
                hideError(emailInput, emailError);
            }
            
            if (isValid) {
                // Show loading state
                const submitButton = forgotPasswordForm.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Sending...';
                submitButton.disabled = true;
                
                // Use jQuery AJAX to submit the form to the correct endpoint
                $.ajax({
                    type: 'POST',
                    url: '/forgot-email-id',
                    contentType: 'application/json',
                    data: JSON.stringify({ email: emailValue }),
                    success: function(response) {
                        // Reset button state
                        submitButton.innerHTML = originalButtonText;
                        submitButton.disabled = false;
                        
                        if (response.success) {
                            // Show success toast
                            showToast('OTP sent successfully! Please check your email.', 'success');
                            
                            // Redirect after a short delay to allow the user to see the toast
                            setTimeout(function() {
                                window.location.href = response.redirectUrl;
                            }, 2000);
                        } else {
                            // Show error in the form and as a toast
                            showError(emailInput, emailError, response.message || 'Failed to send OTP');
                            showToast(response.message || 'Failed to send OTP. Please try again.', 'error');
                        }
                    },
                    error: function(xhr) {
                        // Reset button state
                        submitButton.innerHTML = originalButtonText;
                        submitButton.disabled = false;
                        
                        let errorMessage = "An error occurred, please try again.";
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.message) errorMessage = response.message;
                        } catch (e) {
                            console.error("Error parsing response:", e);
                        }
                        
                        // Show error in the form and as a toast
                        showError(emailInput, emailError, errorMessage);
                        showToast(errorMessage, 'error');
                    }
                });
            }
        });
        
        // Input event listeners for real-time validation
        emailInput.addEventListener('input', function() {
            const emailValue = emailInput.value.trim();
            const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            
            if (emailValue === '') {
                showError(emailInput, emailError, 'Please enter your email address');
            } else if (!emailPattern.test(emailValue)) {
                showError(emailInput, emailError, 'Please enter a valid email address');
            } else {
                hideError(emailInput, emailError);
            }
        });
        
        // Helper functions for showing/hiding errors
        function showError(input, errorElement, message) {
            input.classList.add('is-invalid');
            input.classList.remove('is-valid');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            // Add shake animation to highlight the error
            input.closest('.form-group').classList.add('shake');
            setTimeout(() => {
                input.closest('.form-group').classList.remove('shake');
            }, 500);
        }
        
        function hideError(input, errorElement) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            errorElement.textContent = '';
            errorElement.style.display = 'none';
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            // Create toast container if it doesn't exist
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                document.body.appendChild(toastContainer);
            }
            
            // Create toast element
            const toastId = 'toast-' + Date.now();
            const toastEl = document.createElement('div');
            toastEl.className = `toast ${type}-toast`;
            toastEl.id = toastId;
            toastEl.setAttribute('role', 'alert');
            toastEl.setAttribute('aria-live', 'assertive');
            toastEl.setAttribute('aria-atomic', 'true');
            
            // Set toast icon based on type
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            // Toast content
            toastEl.innerHTML = `
                <div class="toast-header">
                    <i class="fas fa-${icon} me-2"></i>
                    <strong class="me-auto">ELITE WEAR</strong>
                    <small>Just now</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            // Add toast to container
            toastContainer.appendChild(toastEl);
            
            // Initialize and show toast
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 5000
            });
            toast.show();
            
            // Remove toast after it's hidden
            toastEl.addEventListener('hidden.bs.toast', function() {
                toastEl.remove();
            });
        }
        
        // Add animation classes after page load
        setTimeout(() => {
            document.querySelector('.forgot-password-card').classList.add('animate-in');
        }, 100);
    });
</script>
</body>
</html>
