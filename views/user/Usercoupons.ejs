<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELITE WEAR - Available Coupons</title>
    <link rel="stylesheet" href="/userStyle/coupons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Announcement Bar -->
    <div class="announcement-bar">
        <div class="container">
            <p>Get 10% off for your first purchase USE CODE NEW1</p>
        </div>
    </div>

    <!-- Navigation Bar -->
    <%- include("../partials/user/header") %>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <div class="breadcrumb">
                <a href="/profile">profile</a> <i class="fas fa-chevron-right"></i>
                <a href="/coupons">coupons</a> <i class="fas fa-chevron-right"></i>
            </div>

            <div class="content-container">
                <!-- Sidebar -->
                <%- include("../partials/user/profileSidebar") %>

                <!-- Coupons Section -->
                <div class="coupons-section">
                    <h2>Available Coupons</h2>

                    <% if (coupons && coupons.length > 0) { %>
                        <% coupons.forEach(coupon => { %>
                            <div class="coupon-card <%= coupon.status %>">
                                <div class="coupon-details">
                                    <div class="coupon-title">
                                        <%= coupon.coupencode %> - <%= coupon.couponpercent %>% OFF
                                    </div>
                                    <div class="coupon-description">
                                        <%= coupon.description || '' %>
                                        <% if (coupon.minimumPurchase > 0) { %>
                                            <span class="min-purchase">Min. Purchase: â‚¹<%= coupon.minimumPurchase %></span>
                                        <% } %>
                                    </div>
                                    <% if (coupon.status !== 'available') { %>
                                        <div class="coupon-status <%= coupon.status %>">
                                            <%= coupon.statusText %>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="coupon-validity">
                                    <div class="validity-date">
                                        Valid till <%= new Date(coupon.expiryDate).toLocaleDateString('en-US', { day: '2-digit', month: 'short', year: 'numeric' }) %>
                                    </div>
                                    <div class="coupon-code">
                                        <span id="coupon-<%= coupon._id %>"><%= coupon.coupencode %></span>
                                        <% if (coupon.status === 'available') { %>
                                            <button class="copy-btn" onclick="copyCoupon('<%= coupon._id %>', '<%= coupon.coupencode %>')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        <% } %>
                                    </div>
                                    <% if (coupon.limit > 1) { %>
                                        <div class="usage-limit">
                                            Uses: <%= coupon.userUsageCount || 0 %>/<%= coupon.limit %>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="no-coupons">
                            <p>No coupons available at the moment.</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <!-- Pagination -->
<div class="pagination">
    <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>" class="page-btn">Prev</a>
    <% } %>

    <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="?page=<%= i %>" class="page-btn <%= currentPage === i ? 'active' : '' %>"><%= i %></a>
    <% } %>

    <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>" class="page-btn">Next</a>
    <% } %>
</div>


    <!-- Footer -->
    <%- include("../partials/user/footer") %>

    <script>
        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.querySelector('.nav-links').classList.toggle('show');
        });

        // Copy coupon code function
        function copyCoupon(id, code) {
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelector(`#coupon-${id}`).nextElementSibling;
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.classList.add('copied');
                
                // Show toast notification
                showToast('Coupon code copied to clipboard!');
                
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy"></i>';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>